# :rotating_light: OS Lab 6

ToFix:
1. Команда "Remove" не завершает процесс корректно

## Постановка задачи
Требуется разработать программу по асинхронной работе с вычислительными серверами и распределительным узлом, используя концепцию очереди сообщений.

**Тип структуры:** древовидная (корень - распределительный узел, листья и промежуточные вершины - вычислительные узлы).

![Структура](https://github.com/devepodete/os_labs/blob/main/lab6/doc/%D0%A1%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0.png)

Вычислительный узел имеет непосредственный доступ только к ближайшим к нему вершинам, к остальным же необходимо передавать запросы через другие вычислительные узлы.

## Архитектура программы и строение узлов

### Распределительный узел
![Распределительный узел](https://github.com/devepodete/os_labs/blob/main/lab6/doc/%D0%A0%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9%20%D1%83%D0%B7%D0%B5%D0%BB.png)

Распределительный узел работает в 2х-поточном режиме: потоки ```main``` и ```stock```.
1. ```main``` используется для считывания команд от пользователя, их обработки, отправления на вычислительный сервер и получения ответа от того, что команда была получена.
2. ```stock``` используется для получения и вывода остальных ответов от вычислительных узлов, а именно результатов выполнения команд в текстовом виде.

### Вычислительный узел
![Вычислительный узел](https://github.com/devepodete/os_labs/blob/main/lab6/doc/%D0%92%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9%20%D1%83%D0%B7%D0%B5%D0%BB.png)

В вычислительном узле постоянно работает 4 потока: ```main```, ```returner```, ```parent_ping```, ```child_ping```.

1. ```main``` принимает команды от родительского узла, проверяет, ему ли адресована команда.
    * Если да, то отправляет в ```returner``` сообщение о том, что команда получена, создаёт поток ```worker```, в котором начинается её выполнение.
    * Если нет, то отправляет её дочернему узлу.
2. ```returner``` принимает команды от потоков ```main```, ```worker``` и дочернего узла.
    * Если его родитель — управляющий узел, то проверяется полученная команда: команды типа ```ping``` отправляются в ```main``` управляющего узла, остальные — в ```stock```.
    * Если его родитель — не управляющий узел, то команда отправляется родителю.
3. ```parent_ping``` ожидает получение команды от родителя в течение определенного времени. Если команды не поступило, то считается, что родительский узел выведен из строя, происходит переподключение к управляющему узлу.
4. ```child_ping``` раз в определенное количество времени отправляет команду потомку.
5. ```worker``` создается, когда нужно выполнить какое-либо действие (с красно-черным деревом). После выполнения действия в этом потоке, результат отправляется в ```returner``` и поток завершает работу.
